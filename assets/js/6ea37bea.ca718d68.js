"use strict";(self.webpackChunkthothom_com=self.webpackChunkthothom_com||[]).push([[125],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return d}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),m=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=m(e.components);return o.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),u=m(t),d=r,h=u["".concat(l,".").concat(d)]||u[d]||p[d]||i;return t?o.createElement(h,s(s({ref:n},c),{},{components:t})):o.createElement(h,s({ref:n},c))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,s=new Array(i);s[0]=u;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:r,s[1]=a;for(var m=2;m<i;m++)s[m]=t[m];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},3858:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return a},contentTitle:function(){return l},metadata:function(){return m},toc:function(){return c},default:function(){return u}});var o=t(7462),r=t(3366),i=(t(7294),t(3905)),s=["components"],a={sidebar_position:1},l="NestJs",m={unversionedId:"integrations/nestjs",id:"integrations/nestjs",isDocsHomePage:!1,title:"NestJs",description:"Thoth has a integration with NestJs, so you can work with the framework without worry about the integration with the database.",source:"@site/docs/integrations/nestjs.md",sourceDirName:"integrations",slug:"/integrations/nestjs",permalink:"/docs/integrations/nestjs",editUrl:"https://github.com/thothom/thothom.com/edit/master/docs/integrations/nestjs.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"MongoDB",permalink:"/docs/plugins/mongodb"},next:{title:"Use arrays of enums",permalink:"/docs/how-to/arrays-of-enums"}},c=[{value:"Installation",id:"installation",children:[],level:2},{value:"Usage (example with DynamoDB)",id:"usage-example-with-dynamodb",children:[],level:2},{value:"Examples",id:"examples",children:[],level:2},{value:"<code>ThothOMModule</code>",id:"thothommodule",children:[{value:"<code>.forRoot()</code>",id:"forroot",children:[],level:3},{value:"<code>.forFeature()</code>",id:"forfeature",children:[],level:3}],level:2},{value:"Decorators",id:"decorators",children:[{value:"<code>@InjectRepository()</code>",id:"injectrepository",children:[],level:3},{value:"<code>@InjectConnection()</code>",id:"injectconnection",children:[],level:3}],level:2},{value:"Extra Usage Examples",id:"extra-usage-examples",children:[{value:"Multiple Connections",id:"multiple-connections",children:[],level:3}],level:2}],p={toc:c};function u(e){var n=e.components,t=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"nestjs"},"NestJs"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Thoth")," has a integration with NestJs, so you can work with the framework without worry about the integration with the database."),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("p",null,"With Yarn:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"yarn add @thothom/nestjs\n")),(0,i.kt)("p",null,"With NPM:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"npm i @thothom/nestjs\n")),(0,i.kt)("h2",{id:"usage-example-with-dynamodb"},"Usage (example with DynamoDB)"),(0,i.kt)("p",null,"Regardless the integration syntax, it works exactly as the normal ",(0,i.kt)("em",{parentName:"p"},"Thoth"),", so you can use the repositories as always, and the parameters will receive the same values as always."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// app.module.ts\n\nimport { Module } from "@nestjs/common";\nimport { ThothOMModule } from "@thothom/nestjs";\nimport { Connection, DynamoDbConnectionOptions } from "@thothom/dynamodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Module({\n  imports: [\n    ThothOMModule.forRoot<DynamoDbConnectionOptions>({\n      class: Connection,\n      options: {\n        // ...\n        entities: [UserEntity],\n        databaseConfig: {\n          // ...\n        },\n      },\n    }),\n  ],\n})\nexport class AppModule {}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.module.ts\n\nimport { Module } from "@nestjs/common";\nimport { ThothOMModule } from "@thothom/nestjs";\n\nimport { UserService } from "./user.service";\nimport { UserController } from "./user.controller";\nimport { UserEntity } from "./user.entity";\n\n@Module({\n  imports: [ThothOMModule.forFeature([UserEntity])],\n  providers: [UserService],\n  controllers: [UserController],\n})\nexport class UserModule {}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.service.ts\n\nimport { Injectable } from "@nestjs/common";\nimport { InjectRepository } from "@thothom/nestjs";\nimport { Repository, Connection } from "@thothom/dynamodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Injectable()\nexport class UserService {\n  constructor(\n    @InjectRepository(UserEntity)\n    private userRepository: Repository<UserEntity>,\n    @InjectConnection()\n    private connection: Connection\n  ) {}\n\n  findOne(id: string): Promise<User> {\n    return this.userRepository.findOne({\n      where: {\n        id,\n      },\n    });\n  }\n\n  async remove(id: string): Promise<void> {\n    await this.userRepository.delete({\n      id,\n    });\n  }\n}\n')),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/thothom/example-nestjs"},"Basic example"))),(0,i.kt)("h2",{id:"thothommodule"},(0,i.kt)("inlineCode",{parentName:"h2"},"ThothOMModule")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"ThothOMModule")," is the main connection between NestJs and ",(0,i.kt)("em",{parentName:"p"},"Thoth"),". It has 2 methods that allow you to integrate ",(0,i.kt)("em",{parentName:"p"},"Thoth")," in the most performative way possible."),(0,i.kt)("h3",{id:"forroot"},(0,i.kt)("inlineCode",{parentName:"h3"},".forRoot()")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},".forRoot()")," method should be used at your main Module (like ",(0,i.kt)("inlineCode",{parentName:"p"},"AppModule"),"). It will link you code with the database."),(0,i.kt)("p",null,"The method receive two parameters, the first one is the class that you want to use to connect to the database (the one you import from the plugin), and the second one is the connection config."),(0,i.kt)("p",null,"At this config, you must specify ",(0,i.kt)("strong",{parentName:"p"},"all")," of your entities."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// app.module.ts\n\nimport { Module } from "@nestjs/common";\nimport { ThothOMModule } from "@thothom/nestjs";\nimport { Connection, DynamoDbConnectionOptions } from "@thothom/dynamodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Module({\n  imports: [\n    ThothOMModule.forRoot<DynamoDbConnectionOptions>({\n      class: Connection,\n      options: {\n        // ...\n        entities: [UserEntity],\n        databaseConfig: {\n          // ...\n        },\n      },\n    }),\n  ],\n})\nexport class AppModule {}\n')),(0,i.kt)("h3",{id:"forfeature"},(0,i.kt)("inlineCode",{parentName:"h3"},".forFeature()")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},".forFeature()")," method should be used at your domain Module (like ",(0,i.kt)("inlineCode",{parentName:"p"},"UserModule"),"). It will load and inject all the repositories that you will need."),(0,i.kt)("p",null,"The method receive two parameters, the first one is an array of entities (only the ones that you need in this Module), and the second one (optional) is the connection name."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.module.ts\n\nimport { Module } from "@nestjs/common";\nimport { ThothOMModule } from "@thothom/nestjs";\n\nimport { UserService } from "./user.service";\nimport { UserController } from "./user.controller";\nimport { UserEntity } from "./user.entity";\n\n@Module({\n  imports: [ThothOMModule.forFeature([UserEntity])],\n  providers: [UserService],\n  controllers: [UserController],\n})\nexport class UserModule {}\n')),(0,i.kt)("h2",{id:"decorators"},"Decorators"),(0,i.kt)("h3",{id:"injectrepository"},(0,i.kt)("inlineCode",{parentName:"h3"},"@InjectRepository()")),(0,i.kt)("p",null,"Injects a repository."),(0,i.kt)("p",null,"Receives the entity as first parameter and optionally the connection name as second parameter. If no connection name is passed, will get the default connection."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.service.ts\n\nimport { Injectable } from "@nestjs/common";\nimport { InjectRepository } from "@thothom/nestjs";\nimport { Repository } from "@thothom/dynamodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Injectable()\nexport class UserService {\n  constructor(\n    @InjectRepository(UserEntity, "connection_x")\n    private userRepository: Repository<UserEntity>\n  ) {}\n}\n')),(0,i.kt)("h3",{id:"injectconnection"},(0,i.kt)("inlineCode",{parentName:"h3"},"@InjectConnection()")),(0,i.kt)("p",null,"Injects a connection."),(0,i.kt)("p",null,"Receives the connection name as optional parameter. If no connection name is passed, will get the default connection."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.service.ts\n\nimport { Injectable } from "@nestjs/common";\nimport { InjectRepository } from "@thothom/nestjs";\nimport { Repository } from "@thothom/dynamodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Injectable()\nexport class UserService {\n  constructor(\n    @InjectRepository(UserEntity, "connection_x")\n    private userRepository: Repository<UserEntity>\n  ) {}\n}\n')),(0,i.kt)("h2",{id:"extra-usage-examples"},"Extra Usage Examples"),(0,i.kt)("h3",{id:"multiple-connections"},"Multiple Connections"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// app.module.ts\n\nimport { Module } from "@nestjs/common";\nimport { ThothOMModule } from "@thothom/nestjs";\nimport {\n  Connection: DynamoDbConnection,\n  DynamoDbConnectionOptions,\n} from "@thothom/dynamodb";\nimport {\n  Connection: MongodbConnection,\n  MongodbConnectionOptions,\n} from "@thothom/mongodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Module({\n  imports: [\n    ThothOMModule.forRoot<DynamoDbConnectionOptions | MongodbConnectionOptions>([\n      {\n        class: DynamoDbConnection,\n        options: {\n          name: "dynamo"\n          entities: [UserEntity],\n          databaseConfig: {\n            // ...\n          },\n        }\n      } as DynamoDbConnectionOptions, // To get the correct types\n      {\n        class: MongodbConnection,\n        options: {\n          name: "mongo"\n          entities: [UserEntity],\n          databaseConfig: {\n            // ...\n          },\n        }\n      } as MongodbConnectionOptions, // To get the correct types\n    ]),\n  ],\n})\nexport class AppModule {}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.module.ts\n\nimport { Module } from "@nestjs/common";\nimport { ThothOMModule } from "@thothom/nestjs";\n\nimport { UserService } from "./user.service";\nimport { UserController } from "./user.controller";\nimport { UserEntity } from "./user.entity";\n\n@Module({\n  imports: [ThothOMModule.forFeature([UserEntity], "dynamo")],\n  providers: [UserService],\n  controllers: [UserController],\n})\nexport class UserModule {}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// user.service.ts\n\nimport { Injectable } from "@nestjs/common";\nimport { InjectRepository } from "@thothom/nestjs";\nimport { Repository, Connection } from "@thothom/dynamodb";\n\nimport { UserEntity } from "./user.entity";\n\n@Injectable()\nexport class UserService {\n  constructor(\n    @InjectRepository(UserEntity, "dynamo")\n    private userRepository: Repository<UserEntity>,\n    @InjectConnection("dynamo")\n    private connection: Connection\n  ) {}\n\n  findOne(id: string): Promise<User> {\n    return this.userRepository.findOne({\n      where: {\n        id,\n      },\n    });\n  }\n\n  async remove(id: string): Promise<void> {\n    await this.userRepository.delete({\n      id,\n    });\n  }\n}\n')))}u.isMDXComponent=!0}}]);